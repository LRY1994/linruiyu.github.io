<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon"/>
    <link rel="stylesheet" href="/static/css/all.css" />
    <title>大脸圆玉的博客</title>
</head>
<body>
    <div class="l-nav">
        <div class="nav-img">
    <img src="/static/img/avatar.png"/>
</div>


<ul>
    
        
            <li class="li-active"> <a href="/categories/Experience.html">Experience</a></li>
        
        
            <li > <a href="/categories/Reading.html">Reading</a></li>
        
    
        
            <li > <a href="/categories/Collection.html">Collection</a></li>
        
    
</ul>
    </div>
    <div class="r-box">
        <div class="article">
            <h1 class="title">库文件太大，webpack打包时怎么办</h1>            
            <p>I belong to : Experience</p>
            <hr/>
            <p>针对上篇gojs太大的问题的衍生出大文件打包的问题</p>
<h3 id="exclude-设置不通过babel-loader编译的目录">exclude 设置不通过babel-loader编译的目录</h3>
<p>写成从node_modules导入的，就不会出现run慢或者报错，还很快。这是为什么?
是因为node_modules里面不会再实时编译了
那有没有方法，webpack可以设置一些不实时编译的文件</p>
<pre><code class="language-js">{
        test: /\.js$/,
        loader: &#39;babel-loader&#39;,
        include: [resolve(&#39;src&#39;)],
        exclude:[
          resolve(&quot;src/components/common/gojs&quot;)
        ]
      },</code></pre>
<p>exclude可以排除目录 ，不用babel-loader编译</p>
<p>库很大，要么分包 ，或异步加载，或单独引入，否则生成环境打的包会很大</p>
<h3 id="externals设置不打包的文件">externals设置不打包的文件</h3>
<p>打包的时候不打包这个，然后需要在生产环境页面单独引入这个script</p>
<pre><code class="language-js">externals:{
    &#39;go&#39;:&#39;go&#39;
}</code></pre>
<pre><code class="language-html">&lt;script type=&quot;text/javascript&quot; src=&quot;./static/js/go.js&quot;&gt;&lt;/script&gt;</code></pre>
<h3 id="add-asset-html-webpack-plugin">add-asset-html-webpack-plugin</h3>
<p>add-asset-html-webpack-plugin，可以配置修改打包后的index.html.
在webpack.prod.config中引入并添加，用法如下：</p>
<pre><code class="language-js">new AddAssetHtmlPlugin({
    filepath:path.join(__dirname,&#39;src/components/common/gojs/go.js&#39;),
    outputPath:&#39;./static/js&#39;,
    publicPath:&#39;./static/js&#39;,//script标签中的路径前缀
    includeSourcemap:false
})</code></pre>
<p>打包后结果如下：</p>
<pre><code class="language-html">&lt;/div&gt;&lt;/div&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;./static/js/go.js&quot;&gt;&lt;/script&gt;</code></pre>
<h3 id="commonschunkplugin分包，htmlwebpackplugin插入">CommonsChunkPlugin分包，HtmlWebpackPlugin插入</h3>
<p>分包等的时间久点</p>
<pre><code class="language-js">var chunks = [&#39;manifest&#39;, &#39;vendor&#39;, &#39;gojs&#39;, &#39;app&#39;];
new webpack.optimize.CommonsChunkPlugin({
      name: &#39;gojs&#39;,
      minChunks (module) {
        // any required modules inside node_modules are extracted to vendor
        return (
          module.resource &amp;&amp;
          /go\.js$/.test(module.resource) === 0
        )
      }
    }),
 new HtmlWebpackPlugin({
      filename: config.build.index,
      template: &#39;index.html&#39;,
      inject: true,
      minify: {
        removeComments: true,
        collapseWhitespace: true,
        removeAttributeQuotes: true
      },
      chunks,
      chunksSortMode: function(a, b) {
        return chunks.indexOf(a.names[0]) - chunks.indexOf(b.names[0])
      },
    }),</code></pre>

        </div>
    </div>
    
</body>
</html>