<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon"/>
    <link rel="stylesheet" href="/static/css/all.css" />
    <title>大脸圆玉的博客</title>
    <script>
        var alist = document.getElementsByTagName("a");
        for(let i=0;i<alist.length;i++) if(alist[i].href.indexOf('#') < 0) alist[i].target="_blank"    
    </script>
</head>
<body>
    <div class="l-nav">
        <div class="nav-img">
    <img src="/static/img/avatar.png"/>
</div>


<ul>
    
        
            <li class="li-active"> <a href="/categories/Experience.html">Experience</a></li>
        
        
            <li > <a href="/categories/Reading.html">Reading</a></li>
        
    
        
            <li > <a href="/categories/Collection.html">Collection</a></li>
        
    
</ul>
    </div>
    <div class="r-box">
        <div class="article">
            <h1 class="title">原生DOM兼容特性总结</h1>            
            <p>I belong to : Experience</p>
            <hr/>
            <p>浏览器主要也就是IE有点独特，所以把IE重点区分开</p>
<table>
<thead>
<tr>
<th>名称</th>
<th align="left">主流</th>
<th align="left">IE</th>
</tr>
</thead>
<tbody><tr>
<td>内文本</td>
<td align="left">innerText</td>
<td align="left">textContent</td>
</tr>
<tr>
<td>请求对象</td>
<td align="left">XMLHttpRequest</td>
<td align="left">ActiveXObject<br>[&quot;MSXML2.XMLHttp.6.0&quot;,&quot;MSXML2.XMLHttp.3.0&quot;,&quot;MSXML2.XMLHttp&quot;]</td>
</tr>
<tr>
<td>监听事件添加</td>
<td align="left">addEventListener(DOM2),<br> [&#39;on&#39;+eventName](DOM0)</td>
<td align="left">attachEvent</td>
</tr>
<tr>
<td>监听事件移除</td>
<td align="left">removeEventListener(DOM2),<br>[&#39;on&#39;+eventName]=null(DOM0)</td>
<td align="left">detachEvent</td>
</tr>
<tr>
<td>事件对象</td>
<td align="left">function(e) e</td>
<td align="left">window.event(IE7之前)</td>
</tr>
<tr>
<td>阻止默认事件</td>
<td align="left">preventDefault</td>
<td align="left">e.returnValue=false</td>
</tr>
<tr>
<td>阻止冒泡</td>
<td align="left">stopPropagation</td>
<td align="left">e.cancelBubble=true</td>
</tr>
<tr>
<td>键盘事件键盘编码</td>
<td align="left">e.charCode</td>
<td align="left">e.keyCode</td>
</tr>
<tr>
<td>获取剪贴板的文本</td>
<td align="left">e.clipboardData</td>
<td align="left">window.clipboardData</td>
</tr>
<tr>
<td>设置剪贴板文本</td>
<td align="left">e.clipboardData.setData(&quot;text/plain&quot;,value);</td>
<td align="left">window.clipboardData.setData(&quot;text&quot;,value);</td>
</tr>
<tr>
<td>触发事件的元素</td>
<td align="left">e.target</td>
<td align="left">e.srcElement</td>
</tr>
<tr>
<td>获取样式</td>
<td align="left">getComputedStyle(obj,false)[attr];(Firefox浏览器)<br> obj.style.attr(只对filter,opacity等有效)<br>obj.style[attr]</td>
<td align="left">obj.currentStyle[attr];</td>
</tr>
<tr>
<td>窗口左边的位置</td>
<td align="left">window.screenLeft</td>
<td align="left">window.screenX</td>
</tr>
<tr>
<td>页面视口大小</td>
<td align="left">window.innerHeight</td>
<td align="left">if(document.compatMode==&quot;CSS1Compat&quot;)window.documentElement.clientHeight;<br> if(document.compatMode==&quot;BackCompat&quot;)window.body.clientHeight<br></td>
</tr>
<tr>
<td>获取元素</td>
<td align="left">document.getElementById(id);</td>
<td align="left">document.all[id];(IE5)</td>
</tr>
<tr>
<td>返回指定的属性</td>
<td align="left">ele.getAttribute(attr)</td>
<td align="left">ele.attribute[attr]</td>
</tr>
<tr>
<td>ele是否存在指定属性 attr</td>
<td align="left">ele.hasAttribute(attr)</td>
<td align="left">ele.attributes[attr].specified;</td>
</tr>
<tr>
<td>鼠标滚动，正数表示向上滚动</td>
<td align="left">function getWheelDelta(e){<br>if(e.wheelData){<br>return (client.engine.opera&amp;&amp;client.engine.opera&lt;9.5)?<br>-e.wheelData:e.wheelData;<br>}else {<br>return -e.detail*40;//firefox<br>}<br>}</td>
<td align="left"></td>
</tr>
<tr>
<td>提取选中的文本</td>
<td align="left">textbox.value.subString(textbox.selectionStart,textbox.selectionEnd);</td>
<td align="left">document.selection.createRange().text;<br>(IE8之前没有selectionStart，selectionEnd属性</td>
</tr>
<tr>
<td>设置文本选中</td>
<td align="left">textbox.setSelectionRange(startIndex,stopIndex);</td>
<td align="left">var range=textbox.createTextRange();<br>range.collapse(true);<br>range.moveStart(&quot;character&quot;,0);<br>range.moveEnd(&quot;character&quot;,stopIndex-startIndex);<br>range.select()</td>
</tr>
</tbody></table>
<p>下面是积累下来的一些兼容函数，可以当做模板用</p>
<ul>
<li><a href="#%E6%B7%BB%E5%8A%A0%E5%A4%9A%E4%B8%AAonload%E4%BA%8B%E4%BB%B6">添加多个onload事件</a></li>
<li><a href="#%E5%A4%84%E7%90%86ActiveXObject/XMLHttpRequest%E9%97%AE%E9%A2%98">处理ActiveXObject/XMLHttpRequest问题</a></li>
<li><a href="#%E8%AF%B7%E6%B1%82%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95%E8%AE%BE%E7%BD%AE">请求对象的属性和方法设置</a></li>
<li><a href="#%E5%8F%91%E9%80%81%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE">发送表单数据</a></li>
<li><a href="#%E8%B7%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84CORS">跨浏览器的CORS</a></li>
<li><a href="#%E8%B7%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F">跨浏览器事件处理程序</a></li>
<li><a href="#%E5%A4%84%E7%90%86target/srcelemnt%E9%97%AE%E9%A2%98%EF%BC%8C%E4%BB%A3%E6%9B%BFthis">处理target/srcelemnt问题，代替this</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0insertAfter">实现insertAfter</a></li>
<li><a href="#%E7%BB%99element%E5%8A%A0%E4%B8%8A%E7%B1%BB%E5%90%8D">给element加上类名</a></li>
<li><a href="#%E5%88%A4%E6%96%AD%E6%98%AF%E4%B8%8D%E6%98%AF%E6%95%B0%E7%BB%84">判断是不是数组</a></li>
<li><a href="#IE10%E4%B9%8B%E5%89%8D%E4%B8%8D%E6%94%AF%E6%8C%81docunment.getElementByClassName">IE10之前不支持docunment.getElementByClassName</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96css%E6%A0%B7%E5%BC%8F">获取css样式</a></li>
<li><a href="#%E6%89%8B%E5%86%99%E5%8A%A8%E7%94%BB">手写动画</a></li>
<li><a href="#%E5%8F%96%E5%BE%97%E7%AA%97%E5%8F%A3%E5%B7%A6%E8%BE%B9%E5%92%8C%E4%B8%8A%E8%BE%B9%E7%9A%84%E4%BD%8D%E7%BD%AE">取得窗口左边和上边的位置</a></li>
<li><a href="#%E5%8F%96%E5%BE%97%E9%A1%B5%E9%9D%A2%E8%A7%86%E5%8F%A3%E5%A4%A7%E5%B0%8F">取得页面视口大小</a></li>
<li><a href="#%E6%A3%80%E6%B5%8B%E6%8F%92%E4%BB%B6%E6%96%B9%E6%B3%95">检测插件方法</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E5%85%83%E7%B4%A0">获取元素</a></li>
<li><a href="#%E6%A3%80%E6%9F%A5%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9F%90%E4%B8%AA%E7%89%B9%E6%80%A7%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8">检查对象的某个特性是否存在</a></li>
<li><a href="#%E5%AF%B9%E8%B1%A1%E8%BD%AC%E6%8D%A2%E6%88%90%E6%95%B0%E7%BB%84">对象转换成数组</a></li>
<li><a href="#%E8%BF%94%E5%9B%9E%E6%8C%87%E5%AE%9A%E7%9A%84%E5%B1%9E%E6%80%A7">返回指定的属性</a></li>
<li><a href="#ele%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%8C%87%E5%AE%9A%E5%B1%9E%E6%80%A7">ele是否存在指定属性</a></li>
<li><a href="#ele%E6%98%AF%E5%90%A6%E7%AC%A6%E5%90%88%E9%80%89%E6%8B%A9%E5%99%A8selector">ele是否符合选择器selector</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E5%86%85%E6%96%87%E6%9C%AC">获取内文本</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6%E7%9A%84%E7%88%B6%E5%85%83%E7%B4%A0">获取鼠标事件的父元素</a></li>
<li><a href="#%E6%8E%A2%E6%B5%8B%E6%8C%89%E7%9A%84%E6%98%AF%E9%BC%A0%E6%A0%87%E7%9A%84%E5%93%AA%E4%B8%AA%E9%94%AE">探测按的是鼠标的哪个键</a></li>
<li><a href="#%E9%BC%A0%E6%A0%87%E6%BB%9A%E5%8A%A8%E4%BA%8B%E4%BB%B6">鼠标滚动事件</a></li>
<li><a href="#%E6%8F%90%E5%8F%96%E9%80%89%E4%B8%AD%E7%9A%84%E6%96%87%E6%9C%AC">提取选中的文本</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AE%E6%96%87%E6%9C%AC%E9%80%89%E4%B8%AD">设置文本选中</a></li>
<li><a href="#bind%E6%96%B9%E6%B3%95%E5%AF%B9%E8%80%81%E7%89%88%E6%9C%AC%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8D%E8%B5%B7%E4%BD%9C%E7%94%A8">bind方法对老版本的浏览器不起作用</a></li>
<li><a href="#%E5%8C%85%E8%A3%85cookie">包装cookie</a></li>
<li><a href="#%E5%8C%85%E8%A3%85%E5%AD%90cookie">包装子cookie</a></li>
<li><a href="#indexedDB">indexedDB</a></li>
<li><a href="#%E6%89%8B%E5%86%99typeof">手写typeof</a></li>
<li><a href="#%E6%B7%B1%E5%BA%A6%E5%85%8B%E9%9A%86">深度克隆</a></li>
<li><a href="#%E7%BB%84%E5%90%88%E4%BD%BF%E7%94%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E6%A8%A1%E5%BC%8F%E5%92%8C%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1">组合使用构造函数模式和原型模式创建对象</a></li>
<li><a href="#%E7%BB%84%E5%90%88%E7%BB%A7%E6%89%BF">组合继承</a></li>
<li><a href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F">观察者模式</a></li>
<li><a href="#%E5%88%86%E4%BA%AB%E4%B8%80%E4%B8%AA%E9%A2%98%E7%9B%AE">分享一个题目</a></li>
</ul>
<h2 id="添加多个onload事件">添加多个onload事件</h2>
<pre><code class="language-javascript">function addLoadEvent(func){
    var oldonload=window.onload;
    if(typeof window.onload!= &#39;function&#39;){
        window.onload=func;
    }
    else{
        window.onload=function(){
            oldonload();
            func();
        }
    }

}</code></pre>
<h2 id="处理activexobjectxmlhttprequest问题">处理ActiveXObject/XMLHttpRequest问题</h2>
<pre><code class="language-javascript">//第一种写法，《js高级程序设计》的写法  惰性载入技巧
function createXHR(){
    if(typeof XMLHttpRequest!=&quot;undefined&quot;){//XMLHttpRequest
        createXHR=function(){
            return new XMLHttpRequest();
        };
    }else if(typeof ActiveXObject!=&quot;undefined&quot;){//IE ActiveXObject
        createXHR=function(){
            if(typeof arguments.callee.activeXString!=&quot;string&quot;){
                var versions=[&quot;MSXML2.XMLHttp.6.0&quot;,&quot;MSXML2.XMLHttp.3.0&quot;,&quot;MSXML2.XMLHttp&quot;],//IE
                    i,len;
                 for(i=0,len=versions.length;i&lt;len;i++){
                    try{
                        new ActiveXObject(versions[i]);
                        arguments.callee.activeXString=version[i];
                        break;
                    }catch(ex){}
                 }

            }
            return new ActiveXObject(arguments.callee.activeXString);
        };
    }else{
        createXHR=function(){
            throw new Error(&quot;fail&quot;);
        }
    }
    return createXHR();
}

//第二种写法
function createXHR(){
    if(typeof XMLHttpRequest==&quot;undefined&quot;){
        XMLHttpRequest= function () {
            try{
                return new ActiveXObject(&quot;Msxml2.XMLHTTP.6.0&quot;);
            }
            catch (e){}

            try{
                return new ActiveXObject(&quot;Msxml2.XMLHTTP.3.0&quot;);
            }
            catch (e){}

            try{
                return new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;);
            }
            catch (e){}

            return false;
        }
    }
    return new XMLHttpRequest();
}</code></pre>
<h2 id="请求对象的属性和方法设置">请求对象的属性和方法设置</h2>
<pre><code class="language-javascript">var xhr=createXHR();
xhr.onreadystatechange=function(){//firfox引入onlaod，readyState==4时触发,代替onreadystatechange
    if(xhr.readyState==4){
        try{
            if((xhr.status&gt;=200&amp;&amp;xhr.status&lt;300)||xhr.status==304){
                alert(xhr.responseText);
            }else {
                alert(&quot;unsuccessful&quot;);
            }
        }catch(ex){}
    }
}
xhr.onload=function(){
    if((xhr.status&gt;=200&amp;&amp;xhr.status&lt;300)||xhr.status==304){
                alert(xhr.responseText);
            }else {
                alert(&quot;unsuccessful&quot;);
            }
}
xhr.onprogress=function(event){
    if(event.lengthComputable){//进度信息是否可用
        console.log(&quot;Received&quot;+event.position+&quot;of&quot;+event.totalSize);
    }
}
xhr.onerror=function(){
    alert(&quot;error&quot;);
}
xhr.timeout=1000;
xhr.ontimeout=function(){
    alert(&quot;timeout&quot;);
}
xhr.open(&quot;get&quot;,&quot;example.php&quot;,true);
xhr.overrideMimeType(&quot;text/xml&quot;);
xhr.send(null);//GET</code></pre>
<h2 id="发送表单数据">发送表单数据</h2>
<pre><code class="language-javascript">var form=document.getElementById(&quot;info&quot;);
xhr.send(serialize(form));//第一种写法
xhr.send(new FormData(form));//第二种写法</code></pre>
<h2 id="跨浏览器的cors">跨浏览器的CORS</h2>
<pre><code class="language-javascript">function createCORSRequest(method,url){
    var xhr=new XMLHttpRequest();
    if(&quot;withCredentials&quot; in xhr){
        xhr.withCredentials = true;//默认情况下，这样的跨域无法带上目标域的会话（Cookies 等），需要设置xhr 实例的withCredentials 属性为true（IE 还不支持）
        xhr.open(method,url,true);//第三个参数，true 表示异步，false 表示同步
    }else if(typeof XDomainRequest !=&quot;undefined&quot;){
        xhr=new XDomainRequest();
        xhr.open(method,url);
    }else {
        xhr=null;
    }
    return xhr;
}
var request=createCORSRequest(&quot;get&quot;,&quot;http://www.somewhere&quot;);
if(request){
    request.onload=function(){};// 请求成功后
    request.send();
}</code></pre>
<h2 id="跨浏览器事件处理程序">跨浏览器事件处理程序</h2>
<pre><code class="language-javascript">var eventUtil={
    // 页面加载完成后
    readyEvent : function(fn) {
        if (fn==null) {
            fn=document;
        }
        var oldonload = window.onload;
        if (typeof window.onload != &#39;function&#39;) {
            window.onload = fn;
        } else {
            window.onload = function() {
                oldonload();
                fn();
            };
        }
    },

    addEventHandler: function (obj, eventName, handler) {
        if (document.attachEvent) {//IE
            obj.attachEvent(&quot;on&quot; + eventName, handler);
        } else if (document.addEventListener) {//DOM2级
            obj.addEventListener(eventName, handler, false);//false- 默认。事件句柄在冒泡阶段执行
        }
        else{//DOM0级
            obj[&#39;on&#39;+eventName]=handler;
        }
    },

    removeEventHandler:function(obj, eventName, handler){
        if (document.attachEvent) {//IE
            obj.detachEvent(&quot;on&quot; + eventName, handler);
        } else if (document.addEventListener) {//DOM2级
            obj.removeEventListener(eventName, handler, false);
        }
        else{//DOM0级
            obj[&#39;on&#39;+eventName]=null;
        }
    },
   //获取event对象的引用，取到事件的所有信息，确保随时能使用event；
    getEvent: function (e) {
        var ev = e || window.event;
        if (!ev) {
            var c = this.getEvent.caller;
            while (c) {
                ev = c.arguments[0];
                if (ev &amp;&amp; Event == ev.constructor) {
                    break;
                }
                c = c.caller;
            }
        }
        return ev;
    },
    //事件类型
    getType: function (e) {
        return e.type;

    },
    //调用事件的元素
    getElement: function (e) {
        return e.target|| e.srcElement;
    },
    //阻止默认事件
    preventDefault: function (e) {
        e= this.getEvent(e);
        if(e.preventDefault){
            e.preventDefault();
        }
        else {
            return e.returnValue=false;//IE
        }
    },
    //阻止冒泡
    stopPropagation:function(e) {
      if(e.stopPropagation){
          e.stopPropagation();
      }
        else {
          e.cancelBubble=true;//IE
      }

    },
    //键盘事件键盘的编号
    getCharCode:function (e){
        if(typeof e.charCode==&quot;number&quot;)return e.charCode;
        else return e.keyCode;
    },
    //获取剪贴板的文本
    getClipbordText:function(e){
        var clipboardData=(e.clipboardData||window.clipboardData);
        return clipboardData.getData(&quot;text&quot;);
    },
    //设置剪贴板文本
    setClipboardText:function(e,value){
        if(e.clipboardData){
            return e.clipboardData.setData(&quot;text/plain&quot;,value);
        }else if(window.clipboardData){
            return window.clipboardData.setData(&quot;text&quot;,value);
        }
    },

}</code></pre>
<h2 id="处理targetsrcelemnt问题，代替this">处理target/srcelemnt问题，代替this</h2>
<pre><code class="language-javascript">function getActivatedObject(e) {
    var obj;
    if (!e) {
        // early version of IE
        obj = window.event.srcElement;
    } else if (e.srcElement) {
        // IE 7 or later
        obj = e.srcElement;
    } else {
        // DOM Level 2 browser
        obj = e.target;
    }
    return obj;
}</code></pre>
<h2 id="实现insertafter">实现insertAfter</h2>
<pre><code class="language-javascript">/**
 * 把newElement插在targetElement后面 ,js的API只有insertBefore，没有insertAfter
 */
function insertAfter(newElement,targetElement) {
    var parent = targetElement.parentNode;
    if (parent.lastChild == targetElement) {
        parent.appendChild(newElement);
    } else {
        parent.insertBefore(newElement,targetElement.nextSibling);
    }
}</code></pre>
<h2 id="给element加上类名">给element加上类名</h2>
<pre><code class="language-javascript">function addClass(element,value) {
    if (!element.className) {
        element.className = value;
    } else {
        newClassName = element.className;
        newClassName+= &quot; &quot;;
        newClassName+= value;
        element.className = newClassName;
    }
}</code></pre>
<h2 id="判断是不是数组">判断是不是数组</h2>
<pre><code class="language-javascript">function isArray(arg) {
    //return Object.prototype.toString.call(arr)==&#39;[Object Array]&#39;;这种方法也可以
    if (typeof arg == &#39;object&#39;) {
        //所有数组都有一个包含单词&#39;arry&#39;的constructor,最后的i表示不区分大小写
        var criteria = arg.constructor.toString().match(/array/i);
        return (criteria != null);
    }
    return false;
}</code></pre>
<h2 id="ie10之前不支持docunmentgetelementbyclassname">IE10之前不支持docunment.getElementByClassName</h2>
<pre><code class="language-javascript">function getByClass(clsName,parent){
    if(docunment.getElementByClassName) return docunment.getElementByClassName(clsName);
    //IE10之前
    var oParent=parent?document.getElementById(parent):document,
        eles=[],
        elements=oParent.getElementsByTagName(&#39;*&#39;);

    for(var i=0,l=elements.length;i&lt;l;i++){
        if(elements[i].className==clsName){
            eles.push(elements[i]);
        }
    }
    return eles;
}</code></pre>
<h2 id="获取css样式">获取css样式</h2>
<pre><code class="language-javascript">function getStyle(obj,attr){
    if(obj.currentStyle) {//IE 浏览器
        return obj.currentStyle[attr];
    }else{//Firefox浏览器
        return getComputedStyle(obj,false)[attr];
    }
}
</code></pre>
<h2 id="手写动画">手写动画</h2>
<p>多个属性同时运动需要用到JSON,并且所有运动达到目标值才能停止</p>
<pre><code class="language-javascript">//动画 startMove(oLi,{width:400,height:200,opacity:100})
function startMove(obj,json,fn){
    clearInterval(obj.timer);
    obj.timer=setInterval(function () {
        for(var attr in json){
            //1.取当前的值
            var cur=0;
            if(attr==&#39;opacity&#39;){
                cur=Math.round(parseFloat(getStyle(obj,attr))*100);
            }
            else {
                cur=parseInt(getStyle(obj,attr));
            }
            //2.算速度
            var speed=(json[attr]-cur)/8;
            speed=speed&gt;0?Math.ceil(speed):Math.floor(speed);
            //3.检测停止
            var flag=true;
            if(cur!=json[attr]){//使得所有属性做完运动才结束
                flag=false;
            }
            if(attr==&#39;opacity&#39;){
                obj.style.filter=&#39;alpha(opacity:&#39;+(cur+speec)+&#39;)&#39;;
                obj.style.opacity=(cur+speed)/100;
            }
            else{
                obj.style[attr]=(cur+speed)+&#39;px&#39;;
            }
        }
        if(flag){
            clearInterval(obj.timer);
            if(fn){
                fn();
            }
        }
    })
}</code></pre>
<h2 id="取得窗口左边和上边的位置">取得窗口左边和上边的位置</h2>
<pre><code class="language-javascript">var leftPos=(typeof window.screenLeft ==&quot;number&quot;)?window.screenLeft:window.screenX;</code></pre>
<h2 id="取得页面视口大小">取得页面视口大小</h2>
<pre><code class="language-javascript">var pageWidth=window.innerWidth,
    pageHeight=window.innerHeight;
    if(typeof pageHeight!=&quot;number&quot;){
        if(document.compatMode==&quot;CSS1Compat&quot;){//标准模式
            pageHeight=window.documentElement.clientHeight;
            pageWidth=window.documentElement.clientWidth;
        }
        else {//BackCompat
            pageHeight=window.body.clientHeight;
            pageWidth=window.body.clientWidth;
        }
    }</code></pre>
<h2 id="检测插件方法">检测插件方法</h2>
<pre><code class="language-javascript">/**
 *
* 检测插件方法一，IE下无效
*/
function hasPlugin(name){
    name=name.toLowerCase();
    for(var i=0;i&lt;navigator.plugins.length;i++){
        if(navigator.plugins[i].toLowerCase().indexOf(name)!=-1)
        return true;
    }
    return false;
}

/**
 * 检测IE插件方法二 ,name是COM对象唯一标识符
 */
function hasIEPlugin(name){
    try{
        new ActiveXObject(name);
        return true;
    }catch(ex){
        return false;
    }
}</code></pre>
<h2 id="获取元素">获取元素</h2>
<pre><code class="language-javascript">function getElement(id){
    if(document.getElementById){
        return document.getElementById(id);
    }else if(document.all){//IE5前
        return document.all[id];
    }else {
        throw new Error(&quot;no way to retrieve element!&quot;);
    }
}</code></pre>
<h2 id="检查对象的某个特性是否存在">检查对象的某个特性是否存在</h2>
<pre><code class="language-javascript">function isHostMethod(object,property){
    var t =typeof object[property];
    return t==&quot;function&quot;||
           (!!(t==&quot;object&quot;)&amp;&amp;object[property])||
           t==&quot;unknown&quot;;//不懂
}</code></pre>
<h2 id="对象转换成数组">对象转换成数组</h2>
<pre><code class="language-javascript">function convertToArray(nodes){
    var array=null;
    try{
        array=Array.propotype.slice.call(nodes,0);//IE8前无效
    }catch(ex){
        for(var i=0,len=nodes.length;i&lt;len;i++){
            array.push(nodes[i]);
        }
    }
}</code></pre>
<h2 id="返回指定的属性">返回指定的属性</h2>
<pre><code class="language-javascript">/**
 * 
 * 返回指定的属性 IE ele.attribute[]
 * Element.getAttribute()
 */
function outputAttribute(ele){
    var pairs=new Array(),
        attrname,attrvalue,u,len;
    for(i=0,len=ele.attribute.length;i&lt;len;i++){
        attrname=ele.attributes[i].nodeName;
        attrvalue=ele.attributes[i].nodeValue;
        if(ele.attributes[i].specified){//IE
            pairs.push(attrname+&#39;=\&quot;&#39;+attrvalue+&#39;\&quot;&#39;);
        }
    }
}</code></pre>
<h2 id="ele是否存在指定属性">ele是否存在指定属性</h2>
<pre><code class="language-javascript">/**
 * 
 * ele是否存在指定属性 attr
 */
function hasattribute(ele,attr){
    if(ele.hasAttribute){
        return ele.hasAttribute(attr);
    }else {//IE
        return ele.attributes[attr].specified;
    }
}</code></pre>
<h2 id="ele是否符合选择器selector">ele是否符合选择器selector</h2>
<pre><code class="language-javascript">/**
 * ele是否符合选择器selector
 */
function matchesSelector(ele,selector){
    if(ele.matchesSelector){
        return ele.matchesSelector(selector);
    }else if(ele.msmatchesSelector){
        return ele.msmatchesSelector(selector);
    }else if(ele.mozmatchesSelector){
        return ele.mozmatchesSelector(selector);
    }else if(ele.webkitmatchesSelector){
        return ele.webkitmatchesSelector(selector);
    }else{
        throw new Error(&quot;not support&quot;);
    }
}</code></pre>
<h2 id="获取内文本">获取内文本</h2>
<pre><code class="language-javascript">//innerText/textContent
function getInnerText(ele){
    return (typeof ele.innerText==&quot;string&quot;)?
    ele.innerText:ele.textContent;
}</code></pre>
<h2 id="获取鼠标事件的父元素">获取鼠标事件的父元素</h2>
<pre><code class="language-javascript">    function getRelatedTarget(e){
        if(e.relatedTarget) return e.relatedTarget;
        else if(e.fromElement) return e.fromElement;//mouseover
        else if(e.toElement) return e.toElement;//mouseout
        else return null;
    }</code></pre>
<h2 id="探测按的是鼠标的哪个键">探测按的是鼠标的哪个键</h2>
<pre><code class="language-javascript"> function getButton(e){
        if(document.implementation.hasFeature(&quot;MouseEvents&quot;,&quot;2.0&quot;)){
            return e.button;
        }else {
            switch(e.button){
                case 0 :
                case 1:
                case 3:
                case 5:
                case 7: return 0;
                case 2:
                case 6:return 2;
                case 4:return 1;
            }
        }
    }</code></pre>
<h2 id="鼠标滚动事件">鼠标滚动事件</h2>
<pre><code class="language-javascript"> //鼠标滚动，正数表示向上滚动
function getWheelDelta(e){
        if(e.wheelData){
            return (client.engine.opera&amp;&amp;client.engine.opera&lt;9.5)?
        -e.wheelData:e.wheelData;
        }else {
            return -e.detail*40;//firefox
        }

 }
</code></pre>
<h2 id="提取选中的文本">提取选中的文本</h2>
<pre><code class="language-javascript">function getSelectedText(textbox){
    if(typeof selectionStart==&quot;number&quot;){
        return textbox.value.subString(textbox.selectionStart,textbox.selectionEnd);
    }else if(document.selection){//IE8之前没有selectionStart，selectionEnd属性
        return document.selection.createRange().text;
    }
}</code></pre>
<h2 id="设置文本选中">设置文本选中</h2>
<pre><code class="language-javascript">function selectText(textbox,startIndex,stopIndex){
    if(textbox.setSelectionRange){
        textbox.setSelectionRange(startIndex,stopIndex);
    }else if(textbox.createTextRange){//IE
        var range=textbox.createTextRange();
        range.collapse(true);
        range.moveStart(&quot;character&quot;,0);
        range.moveEnd(&quot;character&quot;,stopIndex-startIndex);
        range.select();
    }
}</code></pre>
<h2 id="bind方法对老版本的浏览器不起作用">bind方法对老版本的浏览器不起作用</h2>
<pre><code class="language-javascript">
Function.prototype.bind = Function.prototype.bind || function(context){
      var self = this;

      return function(){
        return self.apply(context, arguments);
      };
    }
</code></pre>
<h2 id="包装cookie">包装cookie</h2>
<pre><code class="language-javascript">

//cookie
var cookieUtil={
    // 创建cookie
    setcookie:function (name, value, expires, path, domain, secure) {
    var cookieText = encodeURIComponent(name) + &#39;=&#39; + encodeURIComponent(value);
    if (expires instanceof Date) {
        cookieText += &#39;; expires=&#39; + expires.toGMTString();
    }
    if (path) {
        cookieText += &#39;; path=&#39; + path;
    }
    if (domain) {
        cookieText += &#39;; domain=&#39; + domain;
    }
    if (secure) {
        cookieText += &#39;; secure&#39;;
    }
    document.cookie = cookieText;
},
    // 获取cookie
    getcookie:function (name) {
    var cookieName = encodeURIComponent(name) + &#39;=&#39;;
    var cookieStart = document.cookie.indexOf(cookieName);
    var cookieValue = null;
    if (cookieStart &gt; -1) {
        var cookieEnd = document.cookie.indexOf(&#39;;&#39;, cookieStart);
        if (cookieEnd == -1) {
            cookieEnd = document.cookie.length;
        }
        cookieValue = decodeURIComponent(document.cookie.substring(cookieStart + cookieName.length, cookieEnd));
    }
    return cookieValue;
},
   // 删除cookie
    unsetcookie:function (name,path,domain,secure) {
    this.setcookie(name,&quot;&quot;,new Date(0),path,domain,secure);
}
}</code></pre>
<h2 id="包装子cookie">包装子cookie</h2>
<pre><code class="language-javascript">//子cookie
var subcookieUtil={
    get:function(name,subname){
        var subcookie=getAll(name);
        if(subcookie){
            return subcookie[subname];
        }else {
            return null;
        }
    },
    getAll:function(name){
        var cookieName = encodeURIComponent(name) + &#39;=&#39;;
        var cookieStart = document.cookie.indexOf(cookieName);
        var cookieValue = null;
        var subcookie,result={};
        var len,i,parts;
        if (cookieStart &gt; -1) {
            var cookieEnd = document.cookie.indexOf(&#39;;&#39;, cookieStart);
            if (cookieEnd == -1) {
            cookieEnd = document.cookie.length;
           }
        cookieValue = document.cookie.substring(cookieStart + cookieName.length, cookieEnd);
        if(cookieValue.length&gt;0){
            subcookie=cookieValue.split(&#39;&amp;&#39;);
            len=subcookie.length;
            for(i=0;i&lt;llen;i++){
                parts=subcookie[i].split(&#39;=&#39;);
                result[parts[0]]=parts[1];
            }
            return result;
        }
       }
    return null;
    },

    set:function (name, subname,value, expires, path, domain, secure) {
        var subcookies=this.getAll(name)||{};
        subcookies[subname]=value;
        this.setAll(name,subcookies,expires,path,domain,secure);
    },

    setAll:function(name,subcookies,expires,path,domain,secure){
        var cookieText = encodeURIComponent(name) + &#39;=&#39;;
        var subcookiesParts=new Array();
        var subname;
        for(subname in subcookies){
            if(subname.length&gt;0&amp;&amp;subcookies.hasOwnProperty(subname)){
                subcookiesParts.push(encodeURIComponent(subname)+&#39;=&#39;+encodeURIComponent(subcookies[subname]));
            }
        }
        if(subcookiesParts.length&gt;0){
            cookieText+=subcookiesParts.join(&#39;&amp;&#39;);
            if (expires instanceof Date) {
                cookieText += &#39;; expires=&#39; + expires.toGMTString();
            }
            if (path) {
                cookieText += &#39;; expires=&#39; + expires;
             }
            if (domain) {
                cookieText += &#39;; domain=&#39; + domain;
            }
            if (secure) {
                cookieText += &#39;; secure&#39;;
            }
        }

        document.cookie = cookieText;
    },
    unset:function(name,subname,path,domain,secure){
          var subcookies=this.getAll(name);
        if(subcookies){
              delete subcookies[subname];
              this.setAll(name,subcookies,null,path,domain,secure);
          }
        },
    unsetAll:function(name,path,domain,secure){
          this.setAll(name,null,new Date(0),path,domain,secure);
    }
}</code></pre>
<h2 id="indexeddb">indexedDB</h2>
<pre><code class="language-javascript">
var indexedDB=window.indexedDB||window.mozIndexedDB||window.msIndexedDB||window.webkitIndexedDB;
var idbRequest=indexedDB.open(&#39;vvv&#39;);
idbRequest.onsuccess=function(event){
    database=event.target.result;
}
idbRequest.onerror=function(event){
    alert(event.target.errorCode);
}</code></pre>
<h3 id="objectcreate">Object.create</h3>
<pre><code class="language-js">var objectCreate = function(arg){
    if(!arg){ return {}};
    function obj(){};
    obj.prototype = arg;
    return new obj();
}
Object.create = Object.create||objectCreate;</code></pre>
<h2 id="手写typeof">手写typeof</h2>
<pre><code class="language-javascript">function type(obj) {
    var toString = Object.prototype.toString;
    var map = {
        &#39;[object Boolean]&#39;  : &#39;boolean&#39;, 
        &#39;[object Number]&#39;   : &#39;number&#39;, 
        &#39;[object String]&#39;   : &#39;string&#39;, 
        &#39;[object Function]&#39; : &#39;function&#39;, 
        &#39;[object Array]&#39;    : &#39;array&#39;, 
        &#39;[object Date]&#39;     : &#39;date&#39;, 
        &#39;[object RegExp]&#39;   : &#39;regExp&#39;, 
        &#39;[object Undefined]&#39;: &#39;undefined&#39;,
        &#39;[object Null]&#39;     : &#39;null&#39;, 
        &#39;[object Object]&#39;   : &#39;object&#39;
    };
    if(obj instanceof Element) {//因为对不同标签，toString会返回对应不同标签的构造函数
        return &#39;element&#39;;
    }
    return map[toString.call(obj)];
}</code></pre>
<h2 id="使用useragent判断使用的是什么浏览器">使用userAgent判断使用的是什么浏览器</h2>
<p>360的兼容模式用的是IE、极速模式用的是chrome的内核</p>
<pre><code class="language-javascript"> function validB(){ 
  var u_agent = navigator.userAgent; 
  var B_name=&quot;Failed to identify the browser&quot;; 
  if(u_agent.indexOf(&quot;Firefox&quot;)&gt;-1){ 
      B_name=&quot;Firefox&quot;; 
  }else if(u_agent.indexOf(&quot;Chrome&quot;)&gt;-1){ 
      B_name=&quot;Chrome&quot;; 
  }else if(u_agent.indexOf(&quot;MSIE&quot;)&gt;-1&amp;&amp;u_agent.indexOf(&quot;Trident&quot;)&gt;-1){ 
      B_name=&quot;IE(8-10)&quot;;  
  }
    document.write(&quot;B_name:&quot;+B_name+&quot;&lt;br&gt;&quot;);
    document.write(&quot;u_agent:&quot;+u_agent+&quot;&lt;br&gt;&quot;); 
} 
</code></pre>
<h2 id="深度克隆">深度克隆</h2>
<pre><code class="language-javascript">/**
 * 
 * 深度克隆方法一，用的是instanceof
 */
function clone(Obj) {
    var buf;   
    if (Obj instanceof Array) {
        buf = [];  // 创建一个空的数组
        var i = Obj.length;
        while (i--) {
            buf[i] = clone(Obj[i]);
        }
        return buf;
    } else if (Obj instanceof Object){
        buf = {};  // 创建一个空对象
        for (var k in Obj) {  // 为这个对象添加新的属性
            buf[k] = clone(Obj[k]);
        }
        return buf;
    }else{
        return Obj;
    }
}

/**
 * 
 * 深度拷贝方法二，用的是 toString
 */
function deepClone(data) {
    var t = type(data), o, i, ni;

    if(t === &#39;array&#39;) {
        o = [];
    }else if( t === &#39;object&#39;) {
        o = {};
    }else {
        return data;
    }

    if(t === &#39;array&#39;) {
        for (i = 0, ni = data.length; i &lt; ni; i++) {
            o.push(deepClone(data[i]));
        }
        return o;
    }else if( t === &#39;object&#39;) {
        for( i in data) {
            o[i] = deepClone(data[i]);
        }
        return o;
    }
}
/**
 * 
 * 深度拷贝方法四，只支持基本数值类型
 * 
1.他无法实现对函数 、RegExp等特殊对象的克隆
2.会抛弃对象的constructor,所有的构造函数会指向Object
3.对象有循环引用,会报错
 */
const newObj = JSON.parse(JSON.stringify(oldObj));

/**
 * 
 * 深度拷贝方法三，更多类型
 */

const isType = (obj, type) =&gt; {
  if (typeof obj !== &#39;object&#39;) return false;
  const typeString = Object.prototype.toString.call(obj);
  let flag;
  switch (type) {
    case &#39;Array&#39;:
      flag = typeString === &#39;[object Array]&#39;;
      break;
    case &#39;Date&#39;:
      flag = typeString === &#39;[object Date]&#39;;
      break;
    case &#39;RegExp&#39;:
      flag = typeString === &#39;[object RegExp]&#39;;
      break;
    default:
      flag = false;
  }
  return flag;
};

const getRegExp = re =&gt; {
  var flags = &#39;&#39;;
  if (re.global) flags += &#39;g&#39;;
  if (re.ignoreCase) flags += &#39;i&#39;;
  if (re.multiline) flags += &#39;m&#39;;
  return flags;
};
/**
* deep clone
* @param  {[type]} parent object 需要进行克隆的对象
* @return {[type]}        深克隆后的对象
*/
const clone = parent =&gt; {
  // 维护两个储存循环引用的数组
  const parents = [];
  const children = [];

  const _clone = parent =&gt; {
    if (parent === null) return null;
    if (typeof parent !== &#39;object&#39;) return parent;

    let child, proto;

    if (isType(parent, &#39;Array&#39;)) {
      // 对数组做特殊处理
      child = [];
    } else if (isType(parent, &#39;RegExp&#39;)) {
      // 对正则对象做特殊处理
      child = new RegExp(parent.source, getRegExp(parent));
      if (parent.lastIndex) child.lastIndex = parent.lastIndex;
    } else if (isType(parent, &#39;Date&#39;)) {
      // 对Date对象做特殊处理
      child = new Date(parent.getTime());
    } else {
      // 处理对象原型
      proto = Object.getPrototypeOf(parent);
      // 利用Object.create切断原型链
      child = Object.create(proto);
    }

    // 处理循环引用
    const index = parents.indexOf(parent);

    if (index != -1) {
      // 如果父数组存在本对象,说明之前已经被引用过,直接返回此对象
      return children[index];
    }
    parents.push(parent);
    children.push(child);

    for (let i in parent) {
      // 递归
      child[i] = _clone(parent[i]);
    }

    return child;
  };
  return _clone(parent);
};

</code></pre>
<h2 id="组合使用构造函数模式和原型模式创建对象">组合使用构造函数模式和原型模式创建对象</h2>
<pre><code class="language-javascript">//组合使用构造函数模式和原型模式创建对象
function Person(name,age){
    this.name=name;
    this.age=age;
    this.friends=[&quot;may&quot;,&quot;john&quot;];
}
Person.prototype={
    constructor:Person,//字面量形式的原型默认构造函数是object,所以在这里要指定constructor
    sayName=function(){
        alert(this.name);
    }
}</code></pre>
<h2 id="组合继承">组合继承</h2>
<pre><code class="language-javascript">//组合继承
funcion super(name){
    this.name=name;
    this.color=[&quot;red&quot;,&quot;blue&quot;];

}
Super.prototype.sayname=function(){
    alert(this.name);
}
function Sub(age){
    Super.call(this);
    this.age=age;
}
Sub.prototype=new Super();//
Sub.prototype.constructor=Sub;//这个很重要！！
Sub.prototype.sayage=function(){
    alert(this.age);
}
</code></pre>
<h2 id="观察者模式">观察者模式</h2>
<pre><code class="language-javascript">//观察者模式
function EventTarget(){     
    this.handlers = {}; 
} 
EventTarget.prototype = {     
    constructor: EventTarget,
    addHandler: function(type, handler){
         if (typeof this.handlers[type] == &quot;undefined&quot;){
              this.handlers[type] = [];
         }
         this.handlers[type].push(handler);
     }, 
    fire: function(event){//执行
         if (!event.target){
             event.target = this;
         }
         if (this.handlers[event.type] instanceof Array){
             var handlers = this.handlers[event.type];
             for (var i=0, len=handlers.length; i &lt; len; i++){
                 handlers[i](event); 
            }
         }
     },
     removeHandler: function(type, handler){ 
        if (this.handlers[type] instanceof Array){ 
            var handlers = this.handlers[type]; 
            for (var i=0, len=handlers.length; i &lt; len; i++){ 
                if (handlers[i] === handler){ 
                    break;
                 }
             }
             handlers.splice(i, 1); 
          }
      }
};</code></pre>
<h2 id="分享一个题目">分享一个题目</h2>
<pre><code class="language-javascript">
//[附加题] 请实现下面的自定义事件 Event 对象的接口，功能见注释(测试1)
//该 Event 对象的接口需要能被其他对象拓展复用(测试2)
//测试1
Event.on(&#39;test&#39;, function (result) {
    console.log(result);
});
Event.on(&#39;test&#39;, function () {
    console.log(&#39;test&#39;);
});
Event.emit(&#39;test&#39;, &#39;hello world&#39;); // 输出 &#39;hello world&#39; 和 &#39;test&#39;
// 测试2
var person1 = {};
var person2 = {};
Object.assign(person1, Event);
Object.assign(person2, Event);
person1.on(&#39;call1&#39;, function () {
    console.log(&#39;person1&#39;);
});
person2.on(&#39;call2&#39;, function () {
    console.log(&#39;person2&#39;);
});
person1.emit(&#39;call1&#39;); //输出 &#39;person1&#39;
person1.emit(&#39;call2&#39;); // 没有输出
person2.emit(&#39;call1&#39;); // 没有输出
person2.emit(&#39;call2&#39;); // 输出 &#39;person2&#39;
var Event = {
    // 通过on接口监听事件eventName
    // 如果事件eventName被触发，则执行callback回调函数
    on: function (eventName, callback) {
        //你的代码
        if(!this.handles){
            //Object.assign(target, source);
//这个是ES6的新对象方法，用于对象的合并，将源对象（source）的所有可枚举属性，复制到目标对象（target）。
            Object.defineProperty(this, &quot;handles&quot;, {
                value: {},
                enumerable: false,//关键！
                configurable: true,
                writable: true
            })
        }

       if(!this.handles[eventName]){
            this.handles[eventName]=[];
       }
       this.handles[eventName].push(callback);
    },
    // 触发事件 eventName
    emit: function (eventName) {
        //你的代码
       if(this.handles[arguments[0]]){
           for(var i=0;i&lt;this.handles[arguments[0]].length;i++){
               this.handles[arguments[0]][i](arguments[1]);
           }
       }
    }
};
//输出所有页面宽度和高度大于50像素的节点。
function traverse(oNode) {
    var aResult = [];
    oNode = oNode || document.body;
    if (oNode.style) {
        var nWidth = window.parseInt(oNode.style.width, 10) || 0;
        var nHeight = window.parseInt(oNode.style.height, 10) || 0;
        if (nWidth &gt; 50 &amp;&amp; nHeight &gt; 50) {
            aResult.push(oNode);
        }
    }
    var aChildNodes = oNode.childNodes;
    if (aChildNodes.length &gt; 0) {
        for (var i = 0, l = aChildNodes.length; i &lt; l; i++) {
            var oTmp = aChildNodes[i];
            aResult = aResult.concat(traverse(oTmp));
        }
    }
    return aResult;
}
</code></pre>
<h3 id="ie的userdata">IE的userData</h3>
<pre><code class="language-javascript"> function set_ud(key,value) {
    var a = document.getElementById(&#39;x&#39;); // x 为任意div 的id 值
    a.addBehavior(&quot;#default#userdata&quot;);
    a.setAttribute(key,value);
    a.save(&quot;db&quot;);
}
function get_ud(key) {
    var a = document.getElementById(&#39;x&#39;);
    a.addBehavior(&quot;#default#userdata&quot;);
    a.load(&quot;db&quot;);
    alert(a.getAttribute(key));
}
function del_ud(key) {
    var a = document.getElementById(&#39;x&#39;);
    a.addBehavior(&quot;#default#userdata&quot;);
    a.setAttribute(key, &quot;&quot;); // 设置为空值即可
    a.save(&quot;db&quot;);
}
window.onload = function(){
    set_ud(&#39;a&#39;,&#39;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#39;); // 设置
    get_ud(&#39;a&#39;); // 获取a 的值
    del_ud(&#39;a&#39;); // 删除a 的值
    get_ud(&#39;a&#39;); // 获取a 的值
};</code></pre>

        </div>
    </div>
    
</body>
</html>